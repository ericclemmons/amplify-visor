#!/usr/bin/env node

const execa = require("execa");
const waitForLocalhost = require("wait-for-localhost");

// Start Amplify Visor on :1337 using local Next.js
execa("next", ["dev", "-p", "1337"], {
  preferLocal: true,
  stdio: "inherit",
  env: { PORT: 1337 },
});

waitForLocalhost({ port: 1337 }).then(() => {
  execa(
    "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome",
    [
      "--new-window",
      "--app=http://localhost:1337/",
      "--explicitly-allowed-ports=1337",
    ],
    {
      stdio: "inherit",
    }
  );
});
